```{r}
library(SeuratDisk)

base <- "/media/chang/HDD-8/joseph/bmi206"

dataset <- "Arthritis"
h5ad_filename <- "GSE243917_ATAC_ALL_CT_processed.h5ad"

# dataset <- "NeurIPS"
# h5ad_filename <- "GSE194122_openproblems_neurips2021_cite_BMMC_processed.h5ad"
# h5ad_filename <- "GSE194122_openproblems_neurips2021_multiome_BMMC_processed.h5ad"

h5ad_path <- file.path(base, dataset, h5ad_filename)

options(future.globals.maxSize = 20e+09)

# Convert the file to Seurat format directly
Convert(h5ad_path, dest = "h5seurat", overwrite = FALSE)

# Load as a Seurat object
obj <- LoadH5Seurat(gsub("\\.h5ad$", ".h5seurat", h5ad_path))

saveRDS(obj, file = file.path(base, dataset, 'seurat_arthritis.rds'))
# saveRDS(obj, file = file.path(base, dataset, 'seurat_neurips_cite.rds'))
# saveRDS(obj, file = file.path(base, dataset, 'seurat_neurips_multiome.rds'))
```